# 十三、智能生活的地方

当构建一个智能系统时，你需要决定智能应该存在于何处。也就是说，您将把模型、运行时和上下文放在一起产生预测，然后您将如何把这些预测返回到智能体验。

运行时可能位于用户的设备中，在这种情况下，您需要弄清楚如何在您的用户群中更新模型。

运行时可以在您运行的服务中，在这种情况下，您必须弄清楚如何以足够低的成本和足够低的延迟将上下文(或功能)从用户的设备获取到服务，以使端到端的体验有效。

这一章讨论了如何决定你的智力应该生活在哪里。它首先讨论了决定智能应该存在的考虑因素，包括延迟和成本，以及为什么这些对于各种类型的智能体验很重要。然后讨论了跨客户端和服务定位智能的常见模式，包括每个选项的优缺点。

## 定位智能的注意事项

在决定智能应该位于何处时，一些关键的考虑因素是:

*   更新情报的延迟。
*   执行智能的延迟。
*   运行智能的成本。
*   用户下线会发生什么。

通常，您必须在这些属性之间进行权衡。本节将依次讨论它们。

### 更新延迟

在决定将智能定位在何处时，需要考虑的一个因素是当您尝试更新智能时会产生的延迟。在新智能进入运行时并取代旧智能之前，它不会给用户带来好处。

当运行时与智能创建环境位于同一台计算机上时，更新智能的延迟可能会非常短；当运行时在客户端计算机上时，延迟可能会很长，并且客户端计算机不经常连接到互联网(因此它只能偶尔获得新的智能)。

在以下情况下，将智能传输到运行时的延迟很重要:

*   智力的质量正在迅速发展。
*   你试图解决的问题变化很快。
*   存在代价高昂的错误风险。

我们将更详细地讨论更新延迟可能导致问题的这些情况，包括它们如何影响智能体验的示例。

#### 质量发展很快

当情报质量快速发展时，更新情报的延迟很重要。

当问题是新的时，很容易取得进展。将会有各种各样的技术去探索。每天都会有新的数据到达，新的用户会以你意想不到的方式使用产品。会有兴奋——能量。智力的质量可能会迅速提高。

例如，假设这是第一天——你刚刚寄出了你的智能鞋。这款鞋可以根据穿着者的动作来调节松紧。无所事事地坐着？鞋子会自动放松，松开鞋带，让穿着者更加舒适。但是如果用户开始跑步呢？跳跃？这种鞋会自动收紧鞋带，所以穿着者会得到更好的支撑，不太可能受伤。

所以你有一个巨大的发射。你在市场上有成千上万的智能鞋。你可以遥测到使用者是如何运动的，他们何时控制鞋子让鞋带更紧，何时控制鞋子让鞋带更松。你会想要获取所有这些数据并产生新的情报。

如果你产生了新的智能，测试它，并确定它并不比你附带的智能好多少——你很好！不需要担心更新情报的延迟，因为你没有获得任何好处。

但是如果新的智能更好——好得多——你会不顾一切地把它推向市场上的所有鞋子。因为你有穿那些鞋的用户。他们会和他们的朋友聊天。评论者将会写文章。你会想要快速更新情报！

当智能快速提高时，部署中的延迟会妨碍智能的利用。这在非常大的问题(有很多很多上下文)或者非常难解决的问题(质量将在未来很长一段时间内得到提高)中尤其重要。

#### 问题变化很快

当问题快速变化时，更新情报的延迟很重要，因为它是开放式的或随时间变化的。

在某些领域，新的上下文会在几周或几个月内缓慢出现。例如，新的道路需要时间来建设；对音乐的品味发展缓慢；新的烤面包机产品不是每天都上市的。在这些情况下，在部署新智能时有几天或几周的延迟可能无关紧要。

另一方面，在一些领域中，新的上下文出现得很快，每天成百上千次。例如，每秒钟都会发生新的垃圾邮件攻击；每天都有数百篇新的新闻报道；飓风登陆；股票市场崩盘。在这些情况下，能够快速部署新的智能可能很重要。

问题如何变化有两个重要方面:

1.  新的上下文出现的速度有多快？
2.  现有环境消失的速度有多快？

在添加了新上下文的领域中，侵蚀会缓慢发生，但旧上下文在相当长的时间内仍然相关。例如，当一条新的道路被建造时，你的智能可能不知道如何处理它，但是你的智能在它知道的所有现有道路上仍然工作良好。

在新环境取代旧环境的领域，侵蚀会很快发生，你昨天拥有的智慧今天不再有用。例如，当一首新歌登上排行榜榜首时，一首老歌就离开了。当垃圾邮件发送者开始新的攻击时，他们会停止旧的攻击。

当问题以侵蚀现有智能质量的方式频繁变化时，更新智能的延迟可能是智能系统成功的关键因素。

#### 代价高昂的错误风险

当智能系统可能犯下需要快速纠正的代价高昂的错误时，更新智能的延迟很重要。

智力会犯各种各样的错误。其中一些错误并不太糟糕，尤其是当智能体验帮助用户处理它们的时候。但是有些错误可能是真正的问题。

以智能鞋为例，鞋带会根据穿着者的动作自动松开或收紧。想象一下，一小部分用户以一种特殊的方式坐立不安，使得鞋子痛苦地夹住他们的脚。

或者想象一下，一小部分用户在棒球队打右外野。百分之九十九的时间，他们站在那里，看着云飘过——然后百分之一的时间，他们拼命冲刺，试图抓住一个高飞球。也许智能鞋跟不上。也许右外野手穿鞋滑倒受伤了。

当您的智能系统的错误有很高的成本，并且这些成本不能通过良好的用户体验来减轻时，延迟会非常痛苦。想象一下，在你等待新的智慧传播的时候，用户日复一日地打电话、抱怨、哭诉你给他们造成的伤害。这会让你感觉很糟糕。这也会让你的企业面临风险。

### 执行中的延迟

决定智能应该位于何处的另一个考虑因素是在运行时执行智能的延迟。

要执行智能，系统必须收集上下文，将上下文转换为特征，将特征传输到智能所在的位置(或者有时整个上下文被传输，然后进行特征提取)，等待智能执行，等待智能执行的结果返回到体验，然后更新体验。这些步骤中的每一步都会在执行智能时引入延迟。

当智能运行时与智能体验驻留在同一台计算机上时，执行中的等待时间可以很短；当智能运行时和智能体验位于不同的计算机上时，时间可能会很长。

在以下情况下，智能执行中的延迟可能是一个问题:

*   用户将不得不等待等待时间。
*   正确的答案变化迅速且剧烈。

延迟及其对用户的影响可能难以预测。有时候用户并不在乎一点点的延迟。有时一点点的延迟会让他们发疯，完全毁掉一次经历。尝试设计这样的体验，其中延迟权衡可以很容易地改变(在编排期间),以便可以用真实用户测试各种选项。

#### 智能体验中的延迟

当用户注意到时，执行中的延迟就很重要，特别是当他们必须等待延迟才能继续执行时。这可能发生在以下情况:

*   智能呼叫是呈现体验的重要部分。想象一下，一个应用需要多次智能调用才能正常呈现。也许应用需要在呈现内容之前弄清楚内容是否对用户有潜在的危害或冒犯。如果用户在等待智能调用时无事可做，那么智能执行的延迟可能是一个问题。
*   情报电话是交互式的。想象一个用户直接与智能交互的应用。也许他们扳动开关，他们期望灯立刻打开。如果开关需要在改变灯光之前检查智能，而智能呼叫需要数百或数千毫秒——用户可能会踮起脚尖。

另一方面，本质上异步的智能体验，如决定是否向用户显示提示，对执行中的延迟不太敏感。

#### 正确答案变化很大

当正确答案变化迅速且剧烈时，执行智能的延迟很重要。

想象一下创造一种智能来驾驶无人机。无人驾驶飞机正驶向一个目标。正确的答案是直接飞向目标。没问题。然后有人走到无人机前面。或者想象一下，无人机在一个美丽、蔚蓝、阳光明媚的日子里飞行，然后不知从哪里突然刮起一阵大风。在这些情况下，无人机的正确控制会发生变化，而且变化很快。

当智能系统的正确行动过程迅速而剧烈地改变时，执行智能的延迟会导致严重的失败。

### 管理费

在决定智能应该存在于何处时，另一个需要考虑的因素是运行智能系统的成本。

分发和执行智能需要 CPU、RAM 和网络带宽。这些都要花钱。影响智能系统成本的一些关键因素包括:

*   分发情报的成本。
*   执行智能的成本。

#### 分发情报的成本

分发情报需要花费服务和用户的钱，通常以带宽收费的形式。每个新的智能都需要托管(例如在 web 服务上)，运行时必须定期检查新的智能，然后下载它找到的任何智能。此成本与智能必须运行的运行时数(托管它的客户端或服务的数量)、智能更新的大小以及更新的频率成比例。对于互联网规模的智能系统，分发智能的成本可能非常大。

为用户考虑成本也很重要。如果主要的用例是宽带用户，那么分发模型可能不是一个问题——它可能不会花费他们太多。但是，当用户使用移动设备时，或者在网络使用被更仔细地计量和计费的地方，用于情报分发的带宽可能成为一个重要的考虑因素。

#### 执行智能的成本

当智能位于服务中并且客户端必须向服务发送上下文(或特征)并获得响应时，执行智能也可能有带宽成本。根据上下文的大小和调用的频率，将上下文发送给服务的成本可能比将智能发送给客户端的成本更高。请记住，遥测和监控还需要从客户那里收集一些背景和特征信息；有机会结合工作和降低成本。

执行智能也要占用 CPU 周期和 RAM。将智能运行时放在客户端的好处是用户支付这些成本。但是某些类型的智能执行起来可能非常昂贵，并且一些客户端(比如移动客户端)有资源限制，这使得重量级智能运行时不切实际。在这些情况下，在服务中使用智能运行时(可能使用定制的硬件，如 GPU 或 FPGAs)可以实现更有效的智能。

在考虑运营成本时，努力实现以下目标:

1.  对用户很敏感，不会要求他们支付对他们很重要的费用(包括带宽，但也包括移动设备的电力，等等)。
2.  确实让用户支付他们不会注意到的那部分费用(这样你就不必购买大量的服务器)。
3.  平衡运行智能系统的所有成本，并随着用户数量和智能质量的增长而扩展。

### 离线操作

在决定智能应该位于何处时，另一个考虑因素是当智能系统离线(并且无法联系任何服务)时，它是否需要工作。

智能系统脱机工作并不总是很重要。例如，当用户在太平洋上空的飞机上时，交通预测系统不需要工作。但有时智能系统确实需要离线工作——例如，当智能运行在受限环境(如军用车辆)或生命攸关的系统中时。

当脱机工作很重要时，客户端中必须有某种智能版本。这可以是完整的智能，也可以更像是备份——整体智能的简化版本，以在服务恢复在线时保持用户运行。

## 放置智能的地方

本节将更详细地探讨一些定位智能的选项。它介绍了一些常见的模式，包括:

*   产品中的静态智能
*   客户端智能
*   服务器为中心的智能
*   后端(缓存)智能
*   混合智能

本节讨论了每一种方法，并探讨了它们如何解决智能应该存在的四个考虑因素:更新延迟、执行延迟、操作成本和离线操作。

### 产品中的静态智能

没有任何智能系统的东西也可以传递智能。只需收集一堆训练数据，生成一个模型，将其与您的软件捆绑在一起，然后交付。

这与发布传统程序非常相似。你构建它，尽你所能测试它——在实验室，或者与客户在焦点小组和 beta 测试中——调整它直到你喜欢它，然后把它发送到世界上。

这样做的好处是设计系统的成本更低。对于许多问题来说，这可能已经足够好了。它可以在用户和智能创造之间没有闭环能力的情况下工作。仍然有可能获得反馈(通过评论和客户支持电话)，并通过传统的软件更新来更新智能。

缺点是智能更新将更加困难，使得这种方法不太适合开放式、时变或困难的问题。

更新情报的延迟:差

执行延迟:非常好

运营成本:便宜

离线操作:是

*   缺点总结:智力更新困难。不可测量的情报错误的风险。没有提高智力的数据。

### 客户端智能

客户端智能完全在客户端执行。也就是说，智能运行时完全驻留在客户端，客户端会定期下载新的智能。

下载通常包括新的模型、如何解释模型输出的新阈值(如果智能被封装在 API 中——它应该如此),以及(有时)新的特征提取代码。

客户端智能通常允许相对更多的资源用于执行智能。其中一个原因是，智能可以以相对较小的成本消耗客户端上的空闲资源(可能除了移动设备上的电源)。另一个原因是，运行时的延迟不会添加到任何服务调用延迟中，因此在以用户可以感知的方式影响体验之前，有相对更多的时间进行处理。

客户端智能的主要挑战是决定何时以及如何向客户端推送新的智能。例如，如果智能是 10 兆字节，并且有 10 万个客户端，那么每次智能更新大约需要 1tb 的带宽。此外，模型往往不能很好地压缩，或者不能很好地处理增量更新，所以这种成本通常需要全额支付。

客户端智能的另一个潜在复杂性是处理不同版本的智能。一些用户将处于脱机状态，无法获得您想要发送给他们的所有情报更新。一些用户可能会选择退出更新(可能会使用防火墙)，因为他们不喜欢将东西下载到他们的机器上。这些情况将使解释用户问题变得更加困难。

客户端模型的另一个缺点是，它们将您的情报交给了任何想要查看它的人:可能是竞争对手，可能是想要滥用您的服务的人，或者您的用户——比如垃圾邮件发送者。一旦有人有了你的模型，他们就可以对它进行测试。他们可以自动化这些测试。他们可以计算出什么类型的输入让模型说出一个答案，什么类型的输入让模型说出另一个答案。他们可以发现对他们的上下文(电子邮件、网页、产品等等)的修改，这些修改会欺骗你的模型，使它犯下他们想要它犯的错误。

更新智能的延迟:可变

执行延迟:非常好

运营成本:基于更新率。

离线操作:是

*   缺点总结:将复杂的智能推给客户端可能成本很高。很难让每个客户端都与更新保持同步。客户端资源可能会受到限制。向世界展示智慧。

### 服务器为中心的智能

以服务器为中心的智能在服务中实时运行。也就是说，客户端获取上下文(或特征)并将它们发送给服务器，服务器对特征执行智能并将结果返回给客户端。

使用以服务器为中心的智能，通过将新模型推送到运行智能的服务器(或多个服务器),可以以受控的方式快速更新模型。这也使得遥测和监控更加容易，因为许多要记录的数据已经作为情报调用的一部分存在于服务中。

但是以服务器为中心的智能需要随着用户群的扩展而扩展。例如，如果每秒有 100 个智能请求，服务必须能够非常快速地执行智能，并且可能是并行的。

更新情报的延迟:好

执行延迟:可变，但包括互联网往返。

运营成本:服务基础设施和带宽成本很高；可能会消耗用户的带宽。

离线操作:否

*   缺点总结:情报呼叫的延迟。服务基础设施和带宽成本。用户带宽成本。运行能够实时执行智能的服务器的成本。

### 后端(缓存)智能

后端智能包括离线运行智能，缓存结果，并在需要的地方交付这些缓存的结果。当分析有限数量的事物时，缓存智能可以是有效的，例如图书馆中的所有电子书，服务可以推荐的所有歌曲，或者销售智能喷洒器的所有邮政编码。但是后端智能也可以用在没有有限数量的事物，但环境变化缓慢的情况下。

例如，一个洒水车被卖到一个新的邮政编码。该服务以前从未考虑过这个邮政编码，所以它在最佳浇水时间返回一些默认的猜测。但是随后后端启动，检查它能找到的关于邮政编码的所有信息，以产生一个好的浇水计划，并将这个浇水计划添加到它的缓存中。下一次在那个邮政编码区出售洒水车时，服务人员会准确地知道如何在那里浇水(也许系统甚至会为那个开始整个过程的可怜的第一个人更新浇水计划)。

与其他选择相比，后端智能系统可以在每个智能决策上花费更多的资源和时间。例如，想象一个超级复杂的浇水计划模型，它在一个高端服务器上运行一个小时，以决定如何在每个邮政编码浇水。它分析卫星图像、交通模式、该地区鸟类和青蛙的迁徙——不惜一切代价。这种模型可能需要几个月的时间才能在洒水器的嵌入式计算机上运行——不切实际。它不能运行在一个每秒钟需要响应数百个呼叫的服务器上——不可能。但它可以“偶尔”在后端运行，其分析结果可以被缓存。

智能缓存可以存在于服务中；它们的一部分也可以分发给客户。

后端智能的一个缺点是更改模型的成本可能会更高，因为所有以前缓存的结果可能都需要重新计算。

另一个缺点是，只有当智能调用的上下文可用于“查找”相关智能时，它才起作用。当上下文描述一个实体，比如一个网页、一个地方或一部电影时，这种方法很有效。当上下文描述不太具体的东西时，如用户生成的文本块、传感器阵列的一系列输出或视频剪辑，它就不起作用了。

更新智能的延迟:可变

执行延迟:可变

运营成本:基于使用量

离线操作:部分

*   缺点总结:当上下文变化很快时，或者当上下文的正确答案变化很快时，效果不好。改变模型和重建智能缓存的成本可能很高。将智能限制在可以查找的事物上。

### 混合智能

在实践中，建立结合了这些方法的混合智能是有用的。

例如，一个系统可能使用后端智能来深入分析流行的项目，并使用客户端智能来评估其他一切。

或者，一个系统在大多数情况下可能使用客户端智能，但是当一个决策产生严重后果时，需要与服务进行双重检查。

混合智能可以掩盖其不同组成部分的弱点。

但是混合智能的构建和编排会更加复杂。考虑一下，如果系统给出了一个不正确的答案，这个错误来自于情报的哪一部分？客户端模型？缓存在服务中的智能？两者之间的某种微妙互动？

有时甚至很难确切知道所有这些组件在出错时处于什么状态。

然而，大多数大型智能系统在决定它们的智能应该位于何处时，都使用某种形式的混合方法。

## 摘要

选择您的智能将生活在哪里是创建一个成功的智能系统的重要组成部分。情报的位置会影响:

*   更新智能的延迟:这是智能从创建环境到运行时需要移动多远的函数，以及运行时进行更新的频率。
*   执行智能的延迟:这是将上下文和特征从智能体验移动到智能运行时并将答案移回来的功能。
*   运行智能系统的成本:这是一个你需要为移动智能、上下文和功能支付多少带宽，以及你需要为执行智能支付多少 CPU 的函数。
*   系统离线工作的能力:这是当它不能与您的服务组件通信时，有多少智能可以在客户机上工作的函数。

有许多选择来平衡这些属性。以下是一些常见的模式:

*   静态智能:这将智能完全放在客户机中，根本不需要将它连接到服务。
*   客户端智能:这将智能完全放在客户端，但将它连接到一个服务以进行智能更新和遥测。
*   以服务器为中心的智能:这将智能完全放在一个服务中，每次需要在上下文中执行智能时都需要一个服务调用。
*   后端(缓存)智能:这在公共上下文中离线执行智能，并通过缓存提供答案。
*   混合智能:这是大多数大规模智能系统的现实，它结合了多种其他方法来实现系统的目标。

## 供思考…

阅读完本章后，您应该:

*   了解智能可以存在的所有地方，从客户端到服务后端，以及每个地方的优缺点。
*   了解智能布局的含义，并能够设计出最适合您系统的实现方案。

你应该能够回答这样的问题:

*   想象一个系统，它有 1MB 的智能模型，每个智能调用有 10KB 的上下文。如果模型需要每天更新，那么在多大数量的用户/情报调用量下，将情报放在服务中而不是客户端中是有意义的？
*   如果您的应用需要在太平洋上空的飞机上工作(没有互联网)，智能放置有哪些选项？
*   如果您的应用需要在飞机上运行，但主要的用例是在用户家中，该怎么办？有哪些选项可以让系统在这两种环境下都表现出色？