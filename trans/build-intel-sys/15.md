# 15.智能遥测

遥测系统负责收集关于用户如何与您的智能系统交互的观察结果，并将部分或全部观察结果发送给您。

例如，每当发生以下任何情况时，遥测系统可能会收集信息:

*   用户访问应用程序的特定部分。
*   用户点击特定的按钮。
*   加载时间长得令人无法接受。
*   客户端连接到服务器。
*   服务器发现格式错误的查询。
*   服务器内存不足。

遥测技术用于验证系统是否按照预期的方式工作。在智能系统中，遥测还包含有关用户与智能的交互以及他们所实现的结果的信息。这些是智力创造者提高智力所需要的信号。

## 为什么需要遥测技术

智能系统中的遥测有三个主要任务:

1.  确保系统按照预期的方式运行。
2.  确保用户得到预期的结果。
3.  收集数据以创造新的更好的情报。

我们将更详细地探讨其中的每一个。

### 确保一切正常

遥测技术应包含足够的数据来确定智能实现是否工作。这应包括:

*   智慧在它应该在的时候流向它应该在的地方。
*   运行时正确加载和解释智能。
*   在运行时正确收集上下文。
*   环境被恰当地转化为特征。
*   运行时合理地执行模型，没有错误。
*   各种情报来源的预测正按计划进行整合。
*   智能的输出被正确地解释并显示正确的用户体验。
*   诸如此类。

这些是您希望在任何服务或应用程序的遥测中包含的内容类型(大多数服务希望遥测更多的内容，如:延迟、正常运行时间、成本和利用率)。

这种遥测技术在智能系统中的一个重要用途是确保智能运行时环境的行为与智能创建环境的行为相同；也就是说，智能是在与它被创造的条件相同的条件下被使用的。这些类型的错误很难发现:整个系统都在运行，用户在交互，没有任何东西输出错误，没有任何东西崩溃，但是用户的结果并不像他们应该的那样好，因为有时智能只是犯了不必要的额外错误。

### 了解结果

遥测应包含足够的信息，以确定用户是否获得积极或消极的结果，以及智能系统是否正在实现其目标。它应该回答这样的问题:

*   用户接受哪些体验，多久接受一次？
*   用户在每次体验中都采取了哪些行动？
*   什么样的体验会促使用户寻求帮助或者撤销或恢复他们的行为？
*   用户遇到特定体验到离开应用的平均时间是多少？
*   随着时间的推移，与系统的智能部分进行更多交互的用户倾向于或多或少地参与(或获利)吗？

这种类型的遥测技术应该足以确保系统的体验有效地将用户与智能联系起来，用户被引导到他们具有更好交互的地方，并且他们的行为方式表明他们正在获得良好的结果。

例如，想象一个帮助医生在 x 射线中识别骨折的系统。为了帮助理解结果，遥测技术应捕捉如下内容:

*   医生在系统认为有骨折的地方看 x 光多长时间。
*   医生在系统认为没有骨折的地方看 x 光多长时间。
*   有多少次当系统认为有骨折时医生会安排治疗。
*   有多少次医生在系统认为没有骨折的情况下命令治疗。
*   有多少次患者因系统标记的骨折而再次入院治疗，但医生决定不予治疗。

这种类型的遥测技术可以帮助你了解患者是否因为智力而获得更好的结果。这也应该有助于你诊断原因。

例如，如果智能正确地识别出非常细微的裂缝，但医生没有进行治疗——为什么会发生这种情况？

也许病人得到了不好的结果，因为智能在微妙的突破上犯了很多错误，所以医生不信任系统的这一部分，并忽略了它。

或者，也许患者得到的结果不好，因为医生根本没有注意到试图向他们指出问题的用户体验——这需要变得更有力。

对用户结果的遥测应该帮助你识别和调试智能和体验如何与用户交互的问题，并采取正确的纠正措施。

### 收集数据以提高智能

遥测技术还应该包括发展智能所需的所有隐式和显式用户反馈。

这包括:

*   用户为响应他们看到的智能体验而采取的行动。
*   用户对他们互动内容的评价。
*   用户提供的报告。
*   用户进行的升级。
*   用户提供的分类。
*   以及用户得到好的或坏的结果的所有隐含指示。

查看第 [9](09.html) 章“从经验中获取数据”，了解更多详情。

为了使这种类型的遥测有用，它必须包含以下所有内容:

1.  交互时用户所处的上下文。
2.  智力产生的预测和它导致的体验。
3.  用户采取的操作。
4.  用户得到的结果(隐含的或者通过明确的反馈)。

在智能创造环境中，必须有可能将单一交互的这四个组成部分相互联系起来。也就是说，必须能够同时找到特定的交互、用户所处的环境、智能做出的预测、用户采取的行动以及用户从交互中获得的结果。

这种类型的遥测技术是制造智能系统的关键，这种智能系统可以封闭使用和智能之间的回路，允许用户从与智能的交互中受益，并允许智能在用户与其交互时变得更好。

## 有效遥测系统的特性

遥测当然好。你想要更多——见鬼，情报创造者会想要全部。他们想要每一次互动的每一个细节(不管代价如何)。如果你不给他们，他们可能会抱怨。他们会问你为什么要毁掉他们。他们会奇怪为什么你要破坏他们美丽的智能系统。

(不是说我做过那个。我只是说说。可能会发生…)

本节讨论平衡遥测成本和价值的方法。其中包括:

*   抽样
*   总结
*   灵活定位

### 抽样

抽样是随机丢弃一些数据的过程。也就是说，如果一天中有 10，000 次用户与系统的交互，则 1%的遥测系统采样将收集 100 次交互的遥测数据(而不收集其余 9，900 次交互的任何数据)。

这种采样数据收集成本更低，更容易存储，处理速度更快，并且通常可以“足够好地”回答关于系统的关键问题。

最简单的抽样形式是均匀抽样。也就是说，无论发生什么类型的事件，都要抽取 1%的样本。但是，不同类型的事件通常有不同的采样目标。例如，一个策略可能是以 0.01%对与验证实施相关的遥测进行采样，以 10%对与增长的智能相关的遥测进行采样，除了来自法国(那里的智能正在挣扎)的遥测应当以 100%进行采样。

定义抽样总体的常用方法包括:

*   按地理位置分开——例如，在欧洲抽取 20%的事件，在亚洲抽取 1%的事件。
*   按用户身份分开—例如，对大多数用户抽取 0.01%的事件，但对这 10 个有问题的用户抽取 100%的事件。
*   按结果(用户在看到智能体验后做了什么)分开——例如，对有正常结果的用户抽样 2%，对有问题的用户抽样 100%。
*   根据上下文(智能启动前用户看到的内容)进行区分，例如，抽取 10%发生在夜间的事件和 0.1%发生在白天的事件。
*   按用户属性(性别、年龄、种族等)划分—例如，对新用户抽样 80%，对长期用户抽样 1%。

一个特别有用的习惯用法是从 0.1%的用户中抽取 100%的数据，这样就可以跟踪会话过程中出现的问题；此外，还从 100%的用户中抽取 1%的事件作为样本，这样您就可以跟踪总体出现的问题。

注意:遥测系统必须记录用于收集每条遥测数据的采样策略，以便智能创建者在使用遥测数据时能够纠正采样方法并产生准确的结果。

### 总结

另一种减少遥测数据的方法是汇总。也就是说，获取原始遥测数据，对其进行一些聚合和过滤，并存储一个小得多的数据摘要。

例如，假设您想知道每天有多少用户撤销一个自动操作。你可以随身携带原始遥测数据，并在需要时计算其数量。或者，您可以每天计算计数，保存并删除原始遥测数据。原始遥测的大小随着使用而增长(并且可能变得非常大)；无论有多少用户，计数的大小都是不变的。

总结对于理解系统如何工作以及是否达到目标非常有效。随着您逐渐了解您的系统，并识别关键的摘要，随着时间的推移，您可以传输和保留越来越少的原始遥测数据。

总结可以在客户端或服务器上完成。

要执行客户端汇总，客户端只需在一段时间内收集遥测数据，在遥测数据到达时进行汇总，并定期向遥测服务器报告汇总的结果(在遥测服务器中，这些结果可能与来自其他客户端的汇总数据相结合)。

当带宽是成本的主要驱动因素时，客户端总结非常有用。

当遥测带宽是免费的(这是客户端访问服务器端智能的副产品)或存储是一个严重的成本驱动因素时，服务器端总结是有用的。在这种情况下，可以定期运行汇总作业来提取所有相关的测量值。完成后，原始数据将被清除以节省空间。

### 灵活定位

系统中有多种遥测技术；有些类型比其他类型更有价值，并且特定类型遥测的价值会随着时间而变化。

例如，在系统开发的早期，在所有代码都正常工作之前，关于实现细节——特性、模型部署等等——的遥测可能非常有用。但是一旦系统被验证并部署给用户，并成功运行数月，这种类型的遥测就变得不那么有用了。

一旦系统开始吸引大量用户，有助于提高智能的遥测技术变得更加重要:它捕捉用户交互的所有价值，他们的判断，他们的偏好。虽然智能在不断增长，但这种类型的遥测是系统的核心价值，是取得成功的关键。

一旦智力达到稳定水平(如果是这样的话)，额外的训练数据可能会变得不那么有价值，而关于用户结果或罕见问题的遥测可能会变得相对更重要。

但是，当出现问题时，所有的赌注都被取消，来自整个系统的遥测数据对于发现和纠正问题至关重要。

一个智能遥测系统应该支持不同类型遥测的不同收集策略，并且这些策略应该可以相对快速和容易地改变，以便指挥者和智能创造者可以完成他们的工作。

## 共同的挑战

本节讨论一些常见的数据陷阱，以及遥测系统在处理这些陷阱时可以发挥的作用。其中包括:

*   偏见
*   罕见事件
*   遥测的间接价值
*   隐私

### 偏见

当一种类型的事件在遥测中出现的次数超过其应有的次数时，就会出现偏差。例如，想象一下有 10，000 个用户与您的智能系统上的内容进行交互的例子。一万是个好数字。这应该足以理解发生了什么，创造一些好的情报。

但是如果你发现所有的一万次互动都是关于同一个内容呢？就像 10，000 个不同的用户在同一个新闻故事互动？

嗯，那就没那么好了。

或者，如果您发现所有 10，000 个样本都来自与该服务交互的一个用户，该怎么办？出于某种原因，遥测系统决定一次又一次地对那个用户进行采样。

那也不好。

以下是可能出现偏差的一些原因:

1.  世界在变，但抽样政策不会变。您设置了一个抽样策略，选择 1000 个用户进行 100%的抽样(这样您就可以看到端到端的交互)。然后，您的用户群增长了 10 倍，并发生了显著变化，包括技术含量较低的用户、其他国家的用户等等。最初的 1，000 名用户在您选择他们时可能是正确的，但他们不再代表您的用户群—这导致了偏见。
2.  用户的行为出乎你的意料。例如，一个有着糟糕体验的用户可以简单地关闭他们的计算机。如果你的遥测系统希望他们在发送遥测数据前关闭应用程序，你可能会错过他们的数据。

处理偏差的一种方法是总是收集所有使用中的原始样本——例如，所有交互的 0.01%——并交叉检查你的其他样本，以确保它们与基线样本没有太大的不同。

### 罕见事件

在某些情况下，许多事件是罕见的事件；一些上下文是突出的，但是你的用户遇到的大多数上下文是不常见的。

例如，在图书馆中，最受欢迎的 100 本书可能占借阅量的 50%，但在这 100 本书之后，使用变得高度分散，成千上万本书每个月都有一两次借阅。当一本书出现在收银台时，有 50%的可能性它是最好的书之一，也有 50%的可能性它是其他两万本书之一。

想象一个系统来帮助推荐这个图书馆的图书。

为了推荐一本书，系统需要查看它经常被借阅的其他书籍。但是任何一对很少使用的书同时被借出的机会是非常非常低的。

例如，如果遥测是通过对 10%的结帐事件进行采样而创建的，一个月后，您可能会:

*   10，000 本前 100 本书的样本。
*   5000 本书，只有一两次结账活动。
*   15，000 本书，完全没有结帐事件。

不太好。这种数据可能有助于你为受欢迎的书籍建立推荐(这很简单，而且你可以更便宜地手工完成)，但它不会给你任何不受欢迎的书籍的信息。

一种选择是分层抽样。可能前 100 本书是 1%抽样，剩下的(冷门)书是 100%抽样。数据量可能类似于对所有书籍使用统一的 10%采样率，但对于产生该系统需要产生的情报类型来说，数据的价值可能大得多。

### 间接价值

通常很难量化遥测的价值，但量化成本却很容易。理性的人会问这样的问题:

*   我们能把这种特殊类型数据的抽样从 10%降到 1%吗？
*   我们能不能停止在这个用例上获取任何遥测数据，我们没有任何计划来添加智能？
*   我们真的需要存储 90 天的历史数据，还是 30 天就够了？

这些都是合理的问题，很难回答。以下是一些有帮助的方法:

1.  保留所有活动的非常小的原始样本，足以进行研究以估计其他遥测的价值。
2.  使打开和关闭遥测变得容易，以便情报编制者可以快速打开遥测来跟踪特定问题，情报创造者可以在短时间内尝试新的方法，看看它们是否值得付出代价。
3.  为创新设定合理的预算，并愿意为潜力买单，而不去微观管理每一个具体细节和成本。

### 隐私

隐私啊隐私。

当使用客户数据时，重要的是“做正确的事情”,并像你希望别人对待你的数据那样对待你的用户数据。请记住一些最佳实践:

*   确保客户了解他们从你的产品中获得的价值，并觉得他们得到了一笔好交易。
*   尽可能地从您存储的遥测数据中删除任何个人信息(如姓名、信用卡、社会保险、地址、用户生成的内容等)。
*   考虑一个针对您打算长期存储的数据的聚合策略，该策略结合了来自许多用户的信息，使得识别任何单个用户的数据变得更加困难(例如，存储每个内容的聚合流量，而不是存储每个用户浏览的内容)。
*   制定合理的保留政策，不要将数据保留太久。
*   确保极其小心地处理遥测技术，防止黑客攻击和意外泄漏。
*   确保顾客知道你在储存什么，以及如何选择退出。
*   按照收集数据的目的使用数据，不要试图将数据用于完全不同的活动。
*   确保你了解你的服务所在国家的法律。

但是请记住:你需要数据——没有数据你就无法创造智能…

## 摘要

良好的遥测技术对于构建有效的智能系统至关重要。没有办法:没有遥测技术，你就不会有一个智能系统。

遥测用于三个主要目的:

1.  确保系统按照预期的方式运行，没有任何错误或问题。
2.  确保用户得到你想要的结果——一切都为了成功而聚集在一起。
3.  随着时间的推移发展智力——以一种你可以用来创造智力的方式记录环境和结果。

这些类型的遥测值会随着时间而改变，系统应该能够适应。一个好的遥测系统将:

*   支持允许跟踪特定焦点问题的抽样，还可以查看总体效果。
*   允许事件摘要。
*   在衡量什么(和不衡量什么)时要灵活。

遥测的一些常见陷阱包括:

*   使遥测数据不能代表用户体验的偏差。
*   重要但很难在采样遥测中捕捉的罕见事件。
*   面对有关相关成本的合理问题，证明遥测技术的价值。
*   保护用户隐私，同时仍允许智能增长。

## 供思考…

阅读完本章后，您应该:

*   了解遥测技术如何通过确保智能系统正常工作、实现其目标并允许其在使用过程中不断改进来实现智能系统。
*   能够设计出满足应用需求的遥测系统。

你应该能够回答这样的问题:

考虑一个你认为你的一个朋友会喜欢使用的智能系统。

*   如果收集所有可能的遥测数据太昂贵，你会如何限制你收集的遥测数据？
*   当出现特定问题时，您需要钻取哪些设施？